# Please do not edit: this file was generated by conf/nginx/generator.rb

upstream linuxfr-frontend {
    server unix:/var/www/linuxfr/production/shared/tmp/sockets/production.sock fail_timeout=0;
}

upstream board-frontend {
    server unix:/var/www/linuxfr/board/board.sock;
}


# HTTP
server {
    listen 80;
    server_name linuxfr.org;
    access_log /var/log/nginx/linuxfr.access.log;
    root /var/www/linuxfr/production/current/public;

    if ($cookie_https = '1') {
        rewrite ^(.*)$ https://linuxfr.org$1 break;
    }

    include /etc/nginx/partials/legacy;
    include /etc/nginx/partials/rails;
}

# HTTPS
server {
    listen 443;
    server_name linuxfr.org;
    access_log /var/log/nginx/linuxfr.access.log;
    root /var/www/linuxfr/production/current/public;

    # SSL
    ssl on;
    ssl_certificate server.crt;
    ssl_certificate_key server.key;

    include /etc/nginx/partials/legacy;
    include /etc/nginx/partials/rails;
}

# No-www
server {
    listen 80;
    server_name www.linuxfr.org;
    rewrite ^/(.*) http://linuxfr.org/$1 permanent;
}
server {
    listen 443;
    server_name www.linuxfr.org;
    ssl on;
    ssl_certificate server.crt;
    ssl_certificate_key server.key;
    rewrite ^/(.*) https://linuxfr.org/$1 permanent;
}
