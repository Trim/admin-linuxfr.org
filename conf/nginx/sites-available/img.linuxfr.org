upstream img-frontend {
    server 127.0.0.1:8000;
}

server {
    server_name img.linuxfr.org;
    access_log /data/prod/logs/img/access.log;
    error_log /data/prod/logs/img/error.log error;
    root /var/www/linuxfr/production/current/uploads;

    listen 80;
    listen 443 ssl;

    ssl_protocols SSLv3 TLSv1;
    ssl_certificate ssl.crt/linuxfr.org.crt;
    ssl_certificate_key ssl.key/linuxfr.org.key;
    ssl_session_cache shared:SSL:2m;
    ssl_ciphers HIGH:!aNULL:!MD5:!kEDH;

    add_header X-Content-Type-Options nosniff;

    location / {
        try_files $uri @img;
    }

	location @img {
        proxy_buffering off;
        proxy_pass http://img-frontend;
	}
}
